<!--pages/translate/translate.wxml-->
<view class="container">
  <view class="translate-panel">
    <view class="language-selector">
      <picker 
        mode="selector" 
        range="{{languagesArray}}" 
        range-key="name" 
        value="{{sourceLangIndex}}" 
        bindchange="changeSourceLang"
      >
        <view class="language-item">
          <text>{{languages[sourceLang].name}}</text>
          <text class="arrow">▼</text>
        </view>
      </picker>
      
      <view class="swap-btn" bindtap="swapLanguages">
        <text class="swap-icon">⇄</text>
      </view>
      
      <picker 
        mode="selector" 
        range="{{languagesArray}}" 
        range-key="name" 
        value="{{targetLangIndex}}" 
        bindchange="changeTargetLang"
      >
        <view class="language-item">
          <text>{{languages[targetLang].name}}</text>
          <text class="arrow">▼</text>
        </view>
      </picker>
    </view>
    
    <view class="input-area">
      <textarea 
        placeholder="请输入要翻译的文本" 
        value="{{sourceText}}" 
        bindinput="handleSourceInput"
        maxlength="2000"
        auto-height
      ></textarea>
      <view class="text-actions">
        <text class="char-count">{{sourceText.length}}/2000</text>
        <view class="clear-btn" bindtap="clearInput" wx:if="{{sourceText}}">×</view>
      </view>
    </view>
    
    <view class="translate-btn-area">
      <button 
        class="translate-btn" 
        bindtap="translateText" 
        disabled="{{!sourceText.trim() || isTranslating}}"
      >
        <text wx:if="{{!isTranslating}}">翻译</text>
        <view wx:else class="loading-dots">
          <view class="dot"></view>
          <view class="dot"></view>
          <view class="dot"></view>
        </view>
      </button>
    </view>
    
    <view class="result-area" wx:if="{{translatedText}}">
      <view class="result-header">
        <text class="result-title">翻译结果</text>
        <view class="copy-btn" bindtap="copyResult">复制</view>
      </view>
      <view class="result-content">
        <text>{{translatedText}}</text>
      </view>
    </view>
  </view>
  
  <view class="history-section">
    <view class="history-header" bindtap="toggleHistory">
      <text>翻译历史</text>
      <text class="toggle-icon">{{showHistory ? '▲' : '▼'}}</text>
    </view>
    
    <view class="history-list" wx:if="{{showHistory}}">
      <view wx:if="{{history.length === 0}}" class="empty-history">
        <text>暂无翻译历史</text>
      </view>
      
      <view wx:else>
        <view 
          class="history-item" 
          wx:for="{{history}}" 
          wx:key="id"
          bindtap="useHistoryItem"
          data-index="{{index}}"
        >
          <view class="history-content">
            <view class="history-source">
              <text class="history-text">{{item.sourceText}}</text>
              <text class="history-lang">{{item.sourceLang}}</text>
            </view>
            <view class="history-translated">
              <text class="history-text">{{item.translatedText}}</text>
              <text class="history-lang">{{item.targetLang}}</text>
            </view>
            <text class="history-time">{{item.time}}</text>
          </view>
          <view 
            class="delete-btn" 
            catchtap="deleteHistoryItem" 
            data-index="{{index}}"
          >×</view>
        </view>
        
        <view class="clear-all-btn" bindtap="clearAllHistory">
          <text>清空历史记录</text>
        </view>
      </view>
    </view>
  </view>
</view>
